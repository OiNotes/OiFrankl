<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</title>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    // –í–∞—à–∏ –∫–ª—é—á–∏
    const supabaseUrl = 'https://nfayxrcrzsdxlwpumnwb.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mYXl4cmNyenNkeGx3cHVtbndiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MDkyMDUsImV4cCI6MjA2OTE4NTIwNX0.ThWlkSh69luGZPLg_y9FOzc56qp3tvhHB8lUWhmeKvI';

    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    function log(message, data = null) {
      const output = document.getElementById('output');
      const line = document.createElement('div');
      line.style.marginBottom = '10px';
      
      if (data) {
        line.innerHTML = `<strong>${message}</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
      } else {
        line.innerHTML = `<strong>${message}</strong>`;
      }
      
      output.appendChild(line);
    }

    async function testConnection() {
      log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
      
      // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã users
      try {
        const { data, error } = await supabase
          .from('users')
          .select('*')
          .limit(5);
        
        if (error) {
          log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ users:', error);
        } else {
          log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ users –¥–æ—Å—Ç—É–ø–Ω–∞! –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ' + data.length, data);
        }
      } catch (e) {
        log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ users:', e);
      }
      
      // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã user_likes
      try {
        const { data, error } = await supabase
          .from('user_likes')
          .select('*')
          .limit(10);
        
        if (error) {
          log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ user_likes:', error);
        } else {
          log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ user_likes –¥–æ—Å—Ç—É–ø–Ω–∞! –ù–∞–π–¥–µ–Ω–æ –ª–∞–π–∫–æ–≤: ' + data.length, data);
        }
      } catch (e) {
        log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ user_likes:', e);
      }
      
      // –¢–µ—Å—Ç 3: –ü–æ–¥—Å—á–µ—Ç –ª–∞–π–∫–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
      log('üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ 1-10:');
      for (let i = 1; i <= 10; i++) {
        try {
          const { count, error } = await supabase
            .from('user_likes')
            .select('*', { count: 'exact', head: true })
            .eq('fragment_id', i);
          
          if (!error && count > 0) {
            log(`   –§—Ä–∞–≥–º–µ–Ω—Ç ${i}: ${count} –ª–∞–π–∫–æ–≤`);
          }
        } catch (e) {
          log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Å—á–µ—Ç–µ –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ ${i}:`, e);
        }
      }
      
      log('‚ú® –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
    }

    window.testConnection = testConnection;
  </script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    h1 {
      color: #333;
    }
    
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-bottom: 20px;
    }
    
    button:hover {
      background: #5558e3;
    }
    
    #output {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase</h1>
  <button onclick="testConnection()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
  <div id="output"></div>
</body>
</html>